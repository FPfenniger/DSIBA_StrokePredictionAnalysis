---
title: "_Appendix"
format: html
editor: visual
---
# Appendix

## From EDA section 

### Proportion of `Stroke` by variables `gender` and `Residence_type`  

```{r, message = FALSE}
#| code-fold: true
#| code-summary: "Click to show code"
library(ggplot2)
library(plotly)
library(dplyr)

# Define choices for the variable selection, including only Gender and Residence Type
x_variable_choices <- c("Gender" = "gender", 
                        "Residence Type" = "Residence_type")

# Create a filtered data frame based on all selected variables
filtered_data <- outlier_stroke_tb
# Remove "Other" for the gender variable
filtered_data <- filtered_data %>% filter(!(gender == "Other"))  # Simply check for 'Other' in gender

# Initialize an empty list to store plots
plots <- list()

# Loop through each categorical variable and create a bar chart
for (selected_variable in x_variable_choices) {
  
  # Get variable name
  variable_name <- names(x_variable_choices)[which(x_variable_choices == selected_variable)]
  
  # For categorical variables such as Gender and Residence Type
  p <- ggplot(filtered_data, aes_string(x = selected_variable, fill = "as.factor(stroke)")) +
    geom_bar(position = "fill") +
    labs(title = paste("Proportion of Stroke by", variable_name),
         fill = "STROKE", y = "Ratio") +
    scale_fill_manual(values = c("0" = "#1f77b4", "1" = "#ff7f0e"))  # Custom colors

  # Convert ggplot to an interactive plotly object and store it in the list
  plots[[variable_name]] <- ggplotly(p)
}

# Display all plots
for (plot in plots) {
  print(plot)  # You can use print to display each plot one after the other
}
```

### Histogram for variable `bmi` from balanced dataset
```{r, message = FALSE}
#| code-fold: true
#| code-summary: "Click to show code"
library(ggplot2)
library(plotly)

# Set the variable to "BMI"
selected_variable <- "bmi"  # Make sure "bmi" is the name of the column in your dataset

# Retrieve the current selected variable and stroke data
original_data <- balanced_stroke_tb[[selected_variable]]
stroke_data <- balanced_stroke_tb$stroke

# Calculate mean and standard deviation
mean_val <- mean(original_data, na.rm = TRUE)  # Handle NA values
sd_val <- sd(original_data, na.rm = TRUE)      # Handle NA values

# Set a default bin width
binwidth <- 1  # You can adjust the bin width based on your data distribution

# Combine data and stroke status into a data frame
plot_data <- data.frame(data = original_data, stroke = factor(stroke_data, labels = c("No Stroke", "Stroke")))

# Generate the ggplot stacked histogram with mean and SD lines
p <- ggplot(plot_data, aes(x = data, fill = stroke)) +
  geom_histogram(binwidth = binwidth, color = "white", position = "stack") +
  labs(title = paste("Distribution of", selected_variable), x = selected_variable, y = "Frequency", fill = "Stroke Status") +
  geom_vline(xintercept = mean_val, color = "blue", linetype = "dashed", linewidth = 1) +
  geom_vline(xintercept = mean_val - sd_val, color = "red", linetype = "dotted", linewidth = 0.8) +
  geom_vline(xintercept = mean_val + sd_val, color = "red", linetype = "dotted", linewidth = 0.8)

# Convert ggplot to an interactive plotly object
ggplotly(p)
```

### Proportion of `Stroke` by variables `gender` and `Residence_Type` for individuals below 60 years old 
```{r, message = FALSE}
#| code-fold: true
#| code-summary: "Click to show code"
library(plotly)
library(ggplot2)
library(dplyr)

# Updated list of categorical variables for the analysis
variables_to_summarize <- c("gender", "Residence_type")

# Function to create a bar chart based on the selected variable
create_bar_chart <- function(data, variable) {
  # Create a reactive data frame that filters "Other" for gender
  filtered_data <- data
  if (variable == "gender") {
    filtered_data <- filtered_data %>% filter(gender != "Other")
  }
  
  # Generate the bar plot
  p <- ggplot(filtered_data, aes_string(x = variable, fill = "as.factor(stroke)")) +
    geom_bar(position = "fill") +
    labs(fill = "STROKE", y = "Proportion", title = paste("Proportion of Stroke by", variable, "for under 60")) +
    theme_minimal() +
    scale_fill_manual(values = c("0" = "#1f77b4", "1" = "#ff7f0e")) # Custom colors

  # Convert ggplot to an interactive plotly object
  ggplotly(p)
}

# Generating and displaying individual plots
for (var in variables_to_summarize) {
  bar_plot <- create_bar_chart(under_60_data, var)
  print(bar_plot)
}
```

### Proportion of `Stroke` by `gender`, `Residence_type`, `smoking_status`, `work_type`  for individuals of 60 and over years old 

```{r, message = FALSE}
#| code-fold: true
#| code-summary: "Click to show code"
library(plotly)
library(ggplot2)
library(dplyr)

# Updated list of categorical variables for the analysis (only the removed variables)
variables_to_summarize <- c("gender", "Residence_type", "smoking_status", "work_type")

# Function to create a bar chart based on the selected variable
create_bar_chart <- function(data, variable) {
  # Create a filtered data frame that excludes "Other" for gender
  filtered_data <- data
  if (variable == "gender") {
    filtered_data <- filtered_data %>% filter(gender != "Other")
  }
  
  # Generate the bar plot
  p <- ggplot(filtered_data, aes_string(x = variable, fill = "as.factor(stroke)")) +
    geom_bar(position = "fill") +
    labs(fill = "STROKE", y = "Proportion", title = paste("Proportion of Stroke by", variable, "for 60 and over")) +
    theme_minimal() +
    scale_fill_manual(values = c("0" = "#1f77b4", "1" = "#ff7f0e")) # Custom colors

  # Convert ggplot to an interactive plotly object
  ggplotly(p)
}

# Generating and displaying individual plots for individuals over 60
for (var in variables_to_summarize) {
  bar_plot <- create_bar_chart(over_60_data, var)
  print(bar_plot)
}
```
